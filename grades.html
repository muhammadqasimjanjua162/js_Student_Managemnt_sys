<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/tailwind.css" />
    <script src="./js/Storage.js"></script>
    <title>Courses</title>
  </head>
  <body class="bg-gray-200">
    <script>

let grades=getDatafromStorage("gradesArray");
console.log(grades,"newGrades")



    </script>
    <header class="body-font bg-white text-gray-400">
      <div
        class="container mx-auto flex flex-col flex-wrap items-center p-5 md:flex-row"
      >
        <nav
          class="flex flex-wrap items-center justify-center text-base md:ml-auto md:mr-auto"
        >
          <a href="students.html" class="mr-5 text-gray-600 hover:text-black"
            >Students</a
          >
          <a href="courses.html" class="mr-5 text-gray-600 hover:text-black"
            >Courses</a
          >
          <a
            href="grades.html"
            class="mr-5 font-medium text-black underline hover:text-black"
            >Grades</a
          >
          <a href="results.html" class="mr-5 text-gray-600 hover:text-black"
            >Results</a
          >
        </nav>
      </div>
    </header>
    <div class="mx-auto flex w-3/4 flex-col items-center justify-center">
      <div class="my-5 flex w-full justify-end">
        <a href="add-grades.html" class="primary-button">Add Grade</a>
      </div>
      <div
        class="container mx-auto max-h-[80%] min-h-[60%] w-full overflow-y-auto rounded-md bg-white p-10 sm:p-4"
      >
        <h2 class="mb-3 text-2xl font-semibold leading-tight">
          All Grades Per Student
        </h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-xs">
            <thead class="rounded-t-lg">
              <tr class="">
                <th title="Ranking" class="p-3 text-left">Sr. No</th>
                <th title="Team name" class="p-3 text-left">Student Name</th>
                <th title="Team name" class="p-3 text-left">Corse Name</th>
                <th title="Wins" class="p-3 text-left">Course Code</th>
                <th title="Wins" class="p-3 text-left">Grade Type</th>
                <th title="Wins" class="p-3 text-left">Assignment #</th>
                <th title="Wins" class="p-3 text-left">Obtained Marks</th>
                <th title="Wins" class="p-3 text-left">Total Marks</th>
                <th title="Current streak" class="p-3 text-center" colspan="2">
                  Action
                </th>
              </tr>
            </thead>
        
            <tbody id="tableBody">
      
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="absolute right-2 top-2 hidden" id="deleteNotification">
      <div
        class="flex max-w-lg items-center justify-between space-x-4 rounded-lg border-l-8 border-red-500 bg-white p-6 text-black sm:py-5"
      >
        <span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="h-6 w-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
        </span>
        <span> Deleted successfully! </span>
      </div>
    </div>
    <div class="absolute right-2 top-2 hidden" id="editedNotification">
      <div
        class="flex max-w-lg items-center justify-between space-x-4 rounded-lg border-l-8 border-green-500 bg-white p-6 text-black sm:py-5"
      >
        <span>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="h-6 w-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
        </span>
        <span> Updated successfully! </span>
      </div>
    </div>
    <div class="absolute top-0 z-10 hidden w-full" id="formContainer">
      <div class="flex w-full items-center justify-center bg-gray-600/50">
        <div
          class="flex-cols relative m-4 flex h-full max-w-4xl flex-col items-center justify-center space-y-10 rounded-lg bg-white p-5 sm:m-10 sm:h-3/4 sm:p-20"
        >
          <h1 class="my-2 py-4 text-center text-3xl font-bold">Edit course</h1>
          <form action="#" class="w-full" method="POST" id="editForm">
            <div class="flex w-full space-x-10">
              <div class="flex flex-col">
                <input type="hidden" name="id" />
                <label class="block cursor-not-allowed py-0.5 px-0.5 text-sm"
                  >Student Name</label
                >
                <input
            
                  required
                  type="text"
                  name="student"
                  placeholder="Student Name"
                  class="form-input cursor-not-allowed"
                />
              </div>
              <div class="flex flex-col">
                <label class="block cursor-not-allowed py-0.5 px-0.5 text-sm"
                  >Course Name</label
                >
                <input
                  required
                  type="text"
                  name="courseName"
                  placeholder="Course Name"
                  class="form-input cursor-not-allowed"
                
                />
              </div>
            </div>
            <div class="my-3 flex w-full space-x-10">
              <div class="flex flex-col">
                <label class="block py-0.5 px-0.5 text-sm">Course Code</label>
                <input
                  required
                  type="text"
                  name="courseCode"
                  placeholder="Course Code"
                  class="form-input cursor-not-allowed"
               
                />
              </div>
              <div class="flex flex-col">
                <label class="block py-0.5 px-0.5 text-sm">Grade Type</label>
                <select class="form-input" name="gradeType">
                  <option>Homework</option>
                  <option>Test</option>
                </select>
              </div>
            </div>
            <div class="my-3 flex w-full space-x-10">
              <!-- Existing fields -->
            
              <!-- Existing fields -->
            </div>
            
            <div class="my-3 flex w-full space-x-10">
              <div class="flex flex-col">
                <input type="hidden" name="id" />
                <label class="block py-0.5 px-0.5 text-sm"
                  >Obtained Marks</label
                >
                <input
                  required
                  type="text"
                  name="obtainedMarks"
                  placeholder="Obtained Marks"
                  class="form-input"
                />
              </div>
              <div class="flex flex-col">
                <label class="block cursor-not-allowed py-0.5 px-0.5 text-sm"
                  >Total Marks</label
                >
                <input
                  required
                  type="text"
                  name="totalMarks"
                  placeholder="Total Marks"
                  class="form-input"
                />
              </div>
              <div class="flex flex-col hidden"   >
                <label class="block py-0.5 px-0.5 text-sm">Assignment #</label>
                <input
              
                  required
                  type="text"
                  name="assignment"
                  placeholder="Assignment #"
                  class="form-input"
                />
              </div>
            </div>

            <div class="mt-10 flex w-full justify-end space-x-3">
              <button type="button" class="secondary-button" id="cancelButton"  onclick="addHidden()">
                Cancel
              </button>
              <button
                type="submit"
                class="rounded-md bg-green-600 px-5 py-2.5 text-white"
                id="editCourseSubmitButton"
                onclick="updateRecord(event)"
              >
                Edit Student
              </button>
            </div>
          </form>

        
        </div>
      </div>
    </div>
    <script>
           const removeHidden=()=>{
  const editForm=document.getElementById("formContainer");
  editForm.classList.remove("hidden");
}
const addHidden=()=>{
  const editForm=document.getElementById("formContainer");
  editForm.classList.add("hidden");
}
        
      let tableBodyName=grades?.map((item)=>`<tr class="">
                <td title="Ranking" class="p-3 text-left">${item.id}</th>
                <td title="Team name" class="p-3 text-left">${item.student}</td>
                <td title="Team name" class="p-3 text-left">${item.courseName}</td>
                <td title="Wins" class="p-3 text-left">${item.courseCode}</td>
                <td title="Wins" class="p-3 text-left">${item.gradeType}</td>
                <td title="Wins" class="p-3 text-left">${item.assignment}</td>
                <td title="Wins" class="p-3 text-left">${item.obtainedMarks}</td>
                <td title="Wins" class="p-3 text-left">${item.totalMarks}</td>
              
                  <td class="px-1 py-2 hover:cursor-pointer editButton" title="Edit" id="${item.id}">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                            </svg>
                        </span>
                    </td>
                     <td class="px-1 py-2 hover:cursor-pointer hover:text-red-500 deleteButton" title="Delete" id="${item.id}">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg>
                        </span>
                    </td>
              
              </tr>
              `).join("");
      document.getElementById("tableBody").innerHTML=tableBodyName;
      const deleteButtons = document.querySelectorAll('.deleteButton');
        console.log(deleteButtons,"delbtns")
        deleteButtons.forEach((ele) => ele.addEventListener("click", function() {
            const btnId = ele.getAttribute('id');
            let gradesData = JSON.parse(localStorage.getItem("gradesArray"));
            const filteredArray = gradesData.filter((item) => item.id !== btnId);
            let deletNotif=document.getElementById("deleteNotification")
            localStorage.setItem("gradesArray", JSON.stringify(filteredArray));
            setTimeout(() => {
                location.reload();
                deletNotif.classList.remove("hidden")
            }, 600);
        }));
        const editButtons=document.querySelectorAll('.editButton');
        editButtons.forEach((ele) => ele.addEventListener("click", function() {
            const btnId = ele.getAttribute('id');
            console.log(btnId,"idddL")
    
            let gradesData = JSON.parse(localStorage.getItem("gradesArray"));
            const recordToEdit = gradesData.find((item) => item.id == btnId);
            console.log(recordToEdit,"editrecord")
           removeHidden();
           
           const array=document.querySelectorAll(".form-input");
           console.log(recordToEdit,"odo")
var{id,student,courseName,courseCode,gradeType,obtainedMarks,totalMarks,assignment}=recordToEdit
    //  var {id, firstName, lastName, rollNo, phoneNo, email } = recordToEdit;
//      console.log(id,"nameidddd")
console.log(assignment,"okkkk")
 const values = [student,courseName,courseCode,gradeType,obtainedMarks,totalMarks,assignment];

document.querySelectorAll(".form-input").forEach((input, index) => {

  input.value = values[index];
});
document.querySelector('input[name="id"]').value = id;
        }
      ));
      const updateRecord=(e)=>{
      e.preventDefault();
     
      var formData = new FormData(document.getElementById("editForm"));
    
    // Convert FormData to an object
    const id = document.querySelector('input[name="id"]').value;
    const updatedStudent = Object.fromEntries(formData.entries());
    console.log(updatedStudent,"solso")
    var inputValue = updatedStudent["student"]; 
    var assignment = updatedStudent["assignment"]
    console.log(inputValue,"bolooooo")
    console.log(updatedStudent,"before")
    updatedStudent.id=id;
    
    console.log(assignment,"oplo")
  console.log(updatedStudent,"molo")
  
      
   
      let studentsData = JSON.parse(localStorage.getItem("gradesArray"));
     
      
      
      console.log(id,"iddd")
     
      const RecordIndex=studentsData.findIndex((item)=>item.id===id);
      console.log(RecordIndex,"index")
      if(RecordIndex!==-1){
        studentsData[RecordIndex]=updatedStudent
      }
         localStorage.setItem("gradesArray", JSON.stringify(studentsData));
         addHidden();
    document.getElementById("editedNotification").classList.remove("hidden");

    setTimeout(() => {
        document.getElementById("editedNotification").classList.add("hidden");
        location.reload();
    }, 1000);
  }
        
        
      </script>
   
  </body>
</html>
